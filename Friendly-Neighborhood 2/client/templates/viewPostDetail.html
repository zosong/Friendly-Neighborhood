<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>View Post Detail</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="/webApp">Friendly Neighborhood</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                My Account
              </a>
              <div
                class="dropdown-menu dropdown-menu-right"
                aria-labelledby="navbarDropdown"
              >
                <a class="dropdown-item" href="/profile">Profile</a>
                <a class="dropdown-item" href="/myPosts">My Posts</a>
                <a class="dropdown-item" href="/blockList">Block List</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="/logout">Log Out</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navigation Bar -->
    <div>
      <h1>Friendly-Neighborhood</h1>
      <h2>{{ post.title }}</h2>
      <h3>{{ post.text }}</h3>
      <p>Last modified: {{ post.last_modified }}</p>
      {% if session['email'] == post.username %}
      <!-- Only show the edit button if the logged-in user is the post owner -->
      <form action="/editPostForm" method="get">
        <input type="hidden" name="postId" value="{{ postId }}" />
        <button type="submit" class="view_post_detail_button">Edit Post</button>
      </form>
      {% endif %}
      <table border="1">
        <thead>
          <tr>
            <td>User</td>
            <td>Text</td>
          </tr>
        </thead>
        {% for comment in comments %}
        <tr>
          <td>
            <div class="dropdown">
              <a
                class="dropdown-toggle"
                href="#"
                role="button"
                id="dropdownMenuLink{{ loop.index }}"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                {{ comment.username }}
              </a>
              <div
                class="dropdown-menu"
                aria-labelledby="dropdownMenuLink{{ loop.index }}"
              >
                <a
                  class="dropdown-item btn btn-primary view_post_detail_button"
                  href="/viewProfile?userId={{ comment.username }}"
                  >Profile</a
                >

                <!-- Only show the block option to the post owner -->
                <form action="/blockUser" method="post">
                  <input
                    type="hidden"
                    name="userToBlock"
                    value="{{ comment.username }}"
                  />
                  {% if session['email'] != comment.username %}
                  <input
                    type="submit"
                    value="Block User"
                    class="view_post_detail_button"
                  />
                  {% endif %}
                </form>
          
              </div>
            </div>
          </td>
          <td>{{ comment.text }}</td>
        </tr>
        {% endfor %}
      </table>

      <form action="/viewPostDetail?postId={{ postId }}" method="POST">
        <textarea
          name="comment"
          rows="4"
          cols="50"
          placeholder="Leave a comment"
        ></textarea>
        <br />

        <input
          type="submit"
          value="Submit Comment"
          class="view_post_detail_button"
          name="comment"
        />
        <input
          type="submit"
          value="I can help!"
          class="view_post_detail_button"
          name="interest"
        />
      </form>
      <a href="/viewPosts?zip_code={{ post.zip_code }}">Back</a>
      <br />
      <a href="/webApp">Back to home</a>
      {% with messages = get_flashed_messages() %} {% if messages %}
      <ul class="flashes">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %} {% endwith %}
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
